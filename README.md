# blog_side_apiï¼ˆåšå®¢ç«¯å¯è¿è¡Œæ ·æ¿ï¼‰

æœ¬ç›®å½•æä¾›ä¸€ä¸ªå¯è¿è¡Œçš„åšå®¢ç«¯ API æ ·æ¿ï¼ŒåŒ…å«ï¼š
- å¯æ‰§è¡ŒæœåŠ¡ï¼ˆFastAPIï¼Œå«ç®¡ç†å‰ç«¯ï¼‰
- æ¸…æ™°çš„ä¸­æ–‡æ³¨é‡Šé…ç½®æ–‡ä»¶
- ä»…åšå®¢ç«¯å±•ç¤ºä¸ç®¡ç†è¯„è®ºï¼ˆä¸å†å¯¹æ¥ bot å›å¤ï¼‰

## âœ¨ åŠŸèƒ½è¯´æ˜
- `GET /`ï¼šå…¬å¼€åšå®¢å•é¡µï¼ˆåˆ—è¡¨ + è¯¦æƒ… + è¯„è®ºï¼‰
- `GET /post/{id}`ï¼šå…¬å¼€åšå®¢å•é¡µæ·±é“¾ï¼ˆåŒä¸€é¡µï¼Œå®šä½åˆ°æŒ‡å®šæ–‡ç« ï¼‰
- `GET /admin`ï¼šç®¡ç†å‰ç«¯å•é¡µï¼ˆTab åˆ‡æ¢ï¼šè¯„è®ºç®¡ç†/æ–‡ç« è¯¦æƒ…/ç¼–è¾‘åšå®¢/åˆ é™¤åšå®¢ï¼‰
- `GET /api/v1/posts`ï¼šå…¬å¼€åšå®¢åˆ—è¡¨æ•°æ®
- `GET /api/v1/posts/{id}`ï¼šå…¬å¼€åšå®¢è¯¦æƒ…æ•°æ®
- `PUT /api/v1/posts/{id}`ï¼šç¼–è¾‘åšå®¢ï¼ˆç®¡ç†ç«¯ä½¿ç”¨ï¼‰
- `DELETE /api/v1/posts/{id}`ï¼šåˆ é™¤åšå®¢ï¼ˆç®¡ç†ç«¯ä½¿ç”¨ï¼‰
- `GET /api/v1/comments`ï¼šç®¡ç†ç«¯è¯„è®ºåˆ—è¡¨
- `PUT /api/v1/comments/{id}`ï¼šç¼–è¾‘è¯„è®ºï¼ˆç®¡ç†ç«¯ä½¿ç”¨ï¼‰
- `DELETE /api/v1/comments/{id}`ï¼šåˆ é™¤è¯„è®ºï¼ˆç®¡ç†ç«¯ä½¿ç”¨ï¼‰
- `GET /api/v1/comments/public?post_id=...`ï¼šå…¬å¼€è¯„è®ºåˆ—è¡¨
- `POST /api/v1/comments/public`ï¼šå…¬å¼€è¯„è®ºæäº¤

## ğŸ“¦ ç›®å½•ç»“æ„
```
blog_side_api/
â”œâ”€â”€ app.py               # FastAPI ç¤ºä¾‹æœåŠ¡
â”œâ”€â”€ config.toml          # é…ç½®æ–‡ä»¶ï¼ˆä¸­æ–‡æ³¨é‡Šï¼‰
â”œâ”€â”€ requirements.txt     # ä¾èµ–
â”œâ”€â”€ README.md            # ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ STRUCTURE.md         # ç»“æ„è¯´æ˜
â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ index.html       # ç®¡ç†å‰ç«¯å•é¡µï¼ˆTab åˆ‡æ¢ï¼‰
â”‚   â”œâ”€â”€ public.html      # å…¬å¼€åšå®¢å•é¡µï¼ˆåˆ—è¡¨ + è¯¦æƒ… + è¯„è®ºï¼‰
â”‚   â””â”€â”€ post.html        # æ—§ç‰ˆè¯¦æƒ…é¡µï¼ˆå½“å‰æœªè¢«è·¯ç”±ä½¿ç”¨ï¼Œä¿ç•™ä½œå‚è€ƒï¼‰
â””â”€â”€ data/
    â”œâ”€â”€ comments.json    # è¯„è®ºæ•°æ®ï¼ˆç¤ºä¾‹ï¼‰
    â””â”€â”€ posts.json       # å…¬å¼€åšå®¢ç¤ºä¾‹æ•°æ®
```

## ğŸš€ å¿«é€Ÿå¯åŠ¨
1. å®‰è£…ä¾èµ–ï¼š
   ```bash
   pip install -r requirements.txt
   ```
2. å¯åŠ¨æœåŠ¡ï¼š
   ```bash
   python app.py
   ```
3. é»˜è®¤ç›‘å¬ï¼š`http://127.0.0.1:8000`
4. æ‰“å¼€ç®¡ç†å‰ç«¯ï¼š`http://127.0.0.1:8000/admin`
5. æ‰“å¼€å…¬å¼€åšå®¢ï¼š`http://127.0.0.1:8000/`

## ğŸ§° éƒ¨ç½²æ•™ç¨‹ï¼ˆæœ¬åœ°/æœåŠ¡å™¨ï¼‰
> ä¸‹é¢æµç¨‹é€‚ç”¨äº Linux æœåŠ¡å™¨æˆ–æœ¬åœ°å¼€å‘ç¯å¢ƒï¼ŒWindows ä¹Ÿå¯æŒ‰å¯¹åº”å‘½ä»¤æ‰§è¡Œã€‚

1. ä¸Šä¼ æˆ–è¿›å…¥é¡¹ç›®ç›®å½•ï¼š
   ```bash
   cd /opt/blog_side_api
   ```
2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š
   - Linux/macOSï¼š
     ```bash
     python3 -m venv .venv
     ```
   - Windowsï¼ˆPowerShellï¼‰ï¼š
     ```powershell
     python -m venv .venv
     ```
3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š
   - Linux/macOSï¼š
     ```bash
     source .venv/bin/activate
     ```
   - Windowsï¼ˆPowerShellï¼‰ï¼š
     ```powershell
     .venv\Scripts\Activate.ps1
     ```
4. å®‰è£…ä¾èµ–ï¼š
   ```bash
   pip install -r requirements.txt
   ```
5. ä¿®æ”¹é…ç½®ï¼š
   - ç¼–è¾‘ [`blog_side_api/config.toml`](blog_side_api/config.toml:1)
   - è®¾ç½® `server.host`ã€`server.port`ã€`auth.api_key`
   - é€‰æ‹©å­˜å‚¨æ–¹å¼ï¼š`storage.storage_type = "json" | "sqlite"`
6. å¯åŠ¨æœåŠ¡ï¼š
   ```bash
   python app.py
   ```
7. è®¿é—®å…¥å£ï¼š
   - ç®¡ç†ç«¯ï¼š`http://<æœåŠ¡å™¨IP>:<ç«¯å£>/admin`
   - å…¬å¼€ç«¯ï¼š`http://<æœåŠ¡å™¨IP>:<ç«¯å£>/`

> åœæ­¢æœåŠ¡ï¼šæŒ‰ `Ctrl + C`ã€‚ä¸‹æ¬¡å¯åŠ¨å‰è®°å¾—å†æ¬¡æ‰§è¡Œæ¿€æ´»è™šæ‹Ÿç¯å¢ƒå‘½ä»¤ã€‚

## ğŸ”§ é…ç½®è¯´æ˜
è¯·ç¼–è¾‘ `config.toml`ï¼Œå­—æ®µå‡å¸¦ä¸­æ–‡æ³¨é‡Šã€‚å…³é”®å­—æ®µï¼š
- `server.host` / `server.port`
- `admin.password`ï¼ˆç®¡ç†ç«¯å¯†ç ï¼Œè¿›å…¥ç®¡ç†é¡µåéœ€è¾“å…¥ï¼‰
- `storage.storage_type`ï¼š`json` æˆ– `sqlite`
- `storage.sqlite_path`ï¼šSQLite æ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼ˆä»… sqlite æ—¶ç”Ÿæ•ˆï¼‰
- `data.comments_file`ï¼ˆè¯„è®ºæ•°æ®æ–‡ä»¶è·¯å¾„ï¼Œä»… json æ—¶ä½¿ç”¨ï¼‰
- `data.posts_file`ï¼ˆå…¬å¼€åšå®¢æ–‡ç« æ•°æ®ï¼Œä»… json æ—¶ä½¿ç”¨ï¼‰
- æ—¶é—´æ ¼å¼ï¼šä½¿ç”¨æœåŠ¡å™¨æœ¬åœ°æ—¶é—´ `ISO8601`ï¼ˆå¦‚ `2026-01-26T11:05:00+08:00`ï¼‰

## ğŸŒ å…¬ç½‘è®¿é—®ä¸åŸŸåé…ç½®ï¼ˆå»ºè®®ï¼‰
> ç›®æ ‡ï¼šåšå®¢ç”¨æˆ·ä¸ bot å‡é€šè¿‡å…¬ç½‘åŸŸåè®¿é—®ã€‚

### 1. ç›‘å¬å…¬ç½‘åœ°å€
åœ¨æœåŠ¡å™¨ä¸Šå°† `server.host` æ”¹ä¸º `0.0.0.0`ï¼Œç¤ºä¾‹ï¼š
```
server.host = "0.0.0.0"
```
è¿™æ ·æœåŠ¡ä¼šç›‘å¬æ‰€æœ‰ç½‘å¡åœ°å€ï¼Œæ‰èƒ½è¢«å…¬ç½‘è®¿é—®ã€‚

### 2. ç»‘å®šåŸŸåä¸ HTTPSï¼ˆæ¨èï¼‰
- è´­ä¹°åŸŸåå¹¶è§£æ A è®°å½•åˆ°æœåŠ¡å™¨å…¬ç½‘ IPï¼ˆå¦‚ `api.yourblog.com`ï¼‰
- æ¨èä½¿ç”¨ Nginx åå‘ä»£ç† + HTTPSï¼ˆå…è´¹è¯ä¹¦å¯ç”¨ Letâ€™s Encryptï¼‰
- bot ç«¯é…ç½®ä½¿ç”¨ `https://api.yourblog.com`

### 3. å®‰å…¨å»ºè®®ï¼ˆåŠ¡å¿…å¼€å¯ï¼‰
- **è®¾ç½®å¼º `admin.password`**ï¼ˆç®¡ç†ç«¯å¯†ç ï¼‰
- **ä¸è¦æŠŠç®¡ç†å‰ç«¯æš´éœ²ç»™æ‰€æœ‰äºº**ï¼š
  - å¯ä»¥åªè®© `/admin` ä»…å†…ç½‘è®¿é—®
  - æˆ–ç”¨ Nginx å¯¹ `/admin` åŠ  HTTP Basic è®¤è¯
- **æ—¥å¿—ç›‘æ§**ï¼šè§‚å¯Ÿå¼‚å¸¸è®¿é—®å’Œé¢‘ç‡

### æœåŠ¡å™¨éƒ¨ç½²è¯´æ˜ï¼ˆå«è™šæ‹Ÿç¯å¢ƒï¼Œæ–°æ‰‹å¯ç›´æ¥ç…§åšï¼‰
1. ä¸Šä¼  `blog_side_api/` å…¨ç›®å½•åˆ°æœåŠ¡å™¨ï¼ˆå»ºè®®æ”¾åœ¨ `/opt/blog_side_api`ï¼‰
2. è¿›å…¥ç›®å½•ï¼š
   ```bash
   cd /opt/blog_side_api
   ```
3. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆç¬¬ä¸€æ¬¡æ‰§è¡Œï¼‰ï¼š
   ```bash
   python3 -m venv .venv
   ```
4. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š
   ```bash
   source .venv/bin/activate
   ```
   > æ¿€æ´»åå‘½ä»¤è¡Œå‰ç¼€ä¼šå‡ºç° `(venv)` æˆ– `(.venv)`ï¼Œè¡¨ç¤ºæˆåŠŸ
5. å‡çº§ pipï¼ˆæ¨èï¼‰ï¼š
   ```bash
   python -m pip install --upgrade pip
   ```
6. å®‰è£…ä¾èµ–ï¼š
   ```bash
   pip install -r requirements.txt
   ```
7. ä¿®æ”¹é…ç½®ï¼š
   - ç¼–è¾‘ [`blog_side_api/config.toml`](blog_side_api/config.toml:1)
   - è®¾ç½® `server.host`ã€`server.port`ã€`admin.password`
   - è‹¥è¦å…¬ç½‘è®¿é—®ï¼š`server.host = "0.0.0.0"`
   - é€‰æ‹©å­˜å‚¨æ–¹å¼ï¼š
     - JSONï¼š`storage.storage_type = "json"`
     - SQLiteï¼š`storage.storage_type = "sqlite"` ä¸”è®¾ç½® `storage.sqlite_path`
8. å¯åŠ¨æœåŠ¡ï¼š
   ```bash
   python app.py
   ```
9. æ‰“å¼€ç®¡ç†å‰ç«¯ï¼š
   - æµè§ˆå™¨è®¿é—®ï¼š`http://<æœåŠ¡å™¨IP>:<ç«¯å£>/admin`
10. æ‰“å¼€å…¬å¼€åšå®¢ï¼š
   - æµè§ˆå™¨è®¿é—®ï¼š`http://<æœåŠ¡å™¨IP>:<ç«¯å£>/`

> åœæ­¢æœåŠ¡ï¼šæŒ‰ `Ctrl + C`ã€‚ä¸‹æ¬¡å¯åŠ¨å‰è®°å¾—å†æ¬¡æ‰§è¡Œ `source .venv/bin/activate`ã€‚
>
> è‹¥ä½¿ç”¨åŸŸåè®¿é—®ï¼Œè¯·åœ¨ bot ç«¯å°† `blog_api_url` é…ç½®ä¸º `https://ä½ çš„åŸŸå`ã€‚
>
> å…¬å¼€åšå®¢å…¥å£ï¼š`/`ï¼ˆå•é¡µï¼šåˆ—è¡¨ + è¯¦æƒ… + è¯„è®ºï¼‰ï¼Œ`/post/{id}` ä¸ºåŒé¡µæ·±é“¾

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹
### æäº¤å…¬å¼€è¯„è®º
```bash
curl -X POST "http://127.0.0.1:8000/api/v1/comments/public" \
  -H "Content-Type: application/json" \
  -d "{\"post_id\":1,\"visitor_name\":\"è®¿å®¢A\",\"content\":\"è¿™ç¯‡æ–‡ç« å†™å¾—å¾ˆå¥½ï¼\"}"
```

### ç®¡ç†ç«¯æŸ¥çœ‹è¯„è®º
```bash
curl "http://127.0.0.1:8000/api/v1/comments" -H "X-ADMIN-PASSWORD: your-admin-password"
```

### ç®¡ç†ç«¯ç¼–è¾‘è¯„è®º
```bash
curl -X PUT "http://127.0.0.1:8000/api/v1/comments/1" \
  -H "X-ADMIN-PASSWORD: your-admin-password" \
  -H "Content-Type: application/json" \
  -d "{\"content\":\"å·²ä¿®æ”¹çš„è¯„è®ºå†…å®¹\"}"
```

### ç®¡ç†ç«¯åˆ é™¤è¯„è®º
```bash
curl -X DELETE "http://127.0.0.1:8000/api/v1/comments/1" \
  -H "X-ADMIN-PASSWORD: your-admin-password"
```

### ç®¡ç†ç«¯ç¼–è¾‘åšå®¢
```bash
curl -X PUT "http://127.0.0.1:8000/api/v1/posts/1" \
  -H "X-ADMIN-PASSWORD: your-admin-password" \
  -H "Content-Type: application/json" \
  -d "{\"title\":\"æ–°æ ‡é¢˜\",\"summary\":\"æ–°æ‘˜è¦\"}"
```

## âš ï¸ æ³¨æ„
æ­¤æ ·æ¿ä¸ºæ•™å­¦ç”¨é€”ï¼Œæ•°æ®ä»¥ JSON æ–‡ä»¶æ¨¡æ‹Ÿå­˜å‚¨ï¼Œå®é™…éƒ¨ç½²è¯·æ›¿æ¢ä¸ºæ•°æ®åº“ã€‚
